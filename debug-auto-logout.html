<!DOCTYPE html>
<html>
<head>
    <title>Auto-Logout Debug Test</title>
</head>
<body>
    <h1>Auto-Logout Debug Test</h1>
    <div id="status">Initializing...</div>
    <div id="logs" style="border: 1px solid #ccc; height: 400px; overflow-y: scroll; padding: 10px; margin-top: 20px;"></div>
    
    <script>
        const logs = document.getElementById('logs');
        const status = document.getElementById('status');
        
        function log(message) {
            console.log(message);
            const timestamp = new Date().toLocaleTimeString();
            logs.innerHTML += `<div>[${timestamp}] ${message}</div>`;
            logs.scrollTop = logs.scrollHeight;
        }
        
        // Test the auto-logout logic in isolation
        const INACTIVITY_LIMIT_MS = 10 * 1000; // 10 seconds for testing
        let inactivityTimerRef = null;
        let activityCount = 0;
        
        function resetInactivityTimer() {
            log('üîÑ Resetting inactivity timer');
            
            if (inactivityTimerRef) {
                clearTimeout(inactivityTimerRef);
                inactivityTimerRef = null;
                log('‚úÖ Cleared existing timer');
            }
            
            inactivityTimerRef = setTimeout(() => {
                log('‚è∞ TIMEOUT REACHED - AUTO LOGOUT WOULD HAPPEN NOW');
                status.textContent = 'AUTO-LOGOUT TRIGGERED!';
                status.style.color = 'red';
                status.style.fontWeight = 'bold';
            }, INACTIVITY_LIMIT_MS);
            
            log(`‚úÖ Timer set for ${INACTIVITY_LIMIT_MS}ms`);
            status.textContent = `Timer active - ${Math.ceil(INACTIVITY_LIMIT_MS/1000)} seconds remaining`;
            status.style.color = 'green';
        }
        
        function handleUserActivity(event) {
            activityCount++;
            log(`üéØ Activity detected: ${event.type} (count: ${activityCount})`);
            resetInactivityTimer();
        }
        
        // Set up event listeners
        const events = ['mousemove', 'mousedown', 'keydown', 'scroll', 'touchstart', 'click'];
        
        log('üì° Setting up event listeners...');
        events.forEach((evt) => {
            window.addEventListener(evt, handleUserActivity, { passive: true });
            log(`‚úÖ Added listener for: ${evt}`);
        });
        
        // Visibility change listener
        document.addEventListener('visibilitychange', () => {
            if (document.visibilityState === 'visible') {
                log('üëÅÔ∏è Tab became visible - resetting timer');
                resetInactivityTimer();
            } else {
                log('üëÅÔ∏è Tab hidden');
            }
        });
        
        // Start the timer
        log('üöÄ Starting inactivity timer...');
        resetInactivityTimer();
        
        // Countdown display
        setInterval(() => {
            if (inactivityTimerRef && status.textContent.includes('Timer active')) {
                const remaining = Math.ceil((INACTIVITY_LIMIT_MS - (Date.now() % INACTIVITY_LIMIT_MS)) / 1000);
                // This is approximate, but gives an idea
            }
        }, 1000);
        
        log('üéØ Test ready! Stay idle for 10 seconds to see auto-logout trigger');
        log('üñ±Ô∏è Move mouse, click, or press keys to reset timer');
    </script>
</body>
</html>